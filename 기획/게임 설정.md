# 게임 설정 & 설계 통합본 (Complete Game Settings & Design)

**목적:** 게임의 모든 핵심 메커니즘, 밸런스, UI 설정을 통합하여 정리한 완전한 설계 문서입니다.

---

## 1. 등급 시스템 (Grade System)

### 1.1. 등급 정의
```
Common(0) < Uncommon(1) < Rare(2) < Epic(3) < Legendary(4)
```

### 1.2. 등급별 역할
- **Customer Grade**: 던전 등급 결정, 등급 보정
- **Dungeon Grade**: 골드 보상 배율, 재료 등급 결정
- **Material Grade**: 희소성 (등급 높을수록 희귀)
- **Weapon Grade**: 성공률 보정, Legendary는 2개 속성 보유

---

## 2. 속성 시스템 (Element System)

### 2.1. 속성 정의
```
Fire, Water, Earth, Air, Thunder, Ice, Light, Dark (총 8개)
```

### 2.2. 속성 상성 관계

#### 순환 상성
```
Fire < Water < Thunder < Earth < Air < Ice < Fire
```

#### 대칭 상성
```
Light ↔ Dark (서로에게 강함)
```

#### 특수 효과
- **Light/Dark**: 다른 모든 속성에 대해 1.3배 특수보정

### 2.3. 속성 적용 범위
- **Customer**: 속성 보유
- **Weapon**: 속성 보유 (Legendary는 2개)
- **Dungeon**: 속성 보유
- **Material**: 속성 없음

---

## 3. 성공률 계산 시스템

### 3.1. 최종 성공률 계산 공식
```
기본 성공률 = (고객레벨 / (고객레벨 + 던전레벨)) × 100

상성보정 합계 = 무기vs던전 상성보정 + 고객vs던전 상성보정
- 무기 vs 던전: 밀림(-20), 무관(0), 유리(+20)  
- 고객 vs 던전: 밀림(-30), 무관(0), 유리(+30)

등급보정 = 고객등급보정 × 무기등급보정

최종 성공률 = (기본 성공률 + 상성보정 합계) 
            × 등급보정
            × 속성보정 (고객-무기 일치시 1.1, 불일치시 1.0)
            × 특수보정 (Light/Dark 1.3)

제한: 최대 100%, 최소 1%
```

### 3.2. 등급보정 상세 (일반 고객)
```
등급차이에 따른 보정 (고객등급 - 던전등급, 무기등급 - 던전등급):
+4등급차: ×2.0    |  -4등급차: ×0.25
+3등급차: ×1.5    |  -3등급차: ×0.6  
+2등급차: ×1.25   |  -2등급차: ×0.8
+1등급차: ×1.1    |  -1등급차: ×0.9
 0등급차: ×1.0
```

### 3.3. Hero 전용 등급보정 (강화된 보정)
```
Hero 고객등급보정 (고객등급 - 던전등급):
+4등급차: ×3.0    |  -4등급차: ×0.4
+3등급차: ×2.0    |  -3등급차: ×0.7  
+2등급차: ×1.4    |  -2등급차: ×0.9
+1등급차: ×1.2    |  -1등급차: ×1.0
 0등급차: ×1.0

※ 일반 고객 대비 강화된 보정값
무기등급보정은 일반 고객과 동일
```

---

## 4. 고객 생성 시스템

### 4.1. 고객 등급 확률 (기본값, 일수별 변동 가능)
```
Common: 75%
Uncommon: 14%  
Rare: 7%
Epic: 3%
Legendary: 1%
```

### 4.2. 고객 레벨 계산
```
고객 레벨 = 1 + (진행일수 × 0.2) + 등급보정

등급보정 (Random 범위):
Common(0): -10 ~ +5
Uncommon(1): -7 ~ +6  
Rare(2): -5 ~ +7
Epic(3): -3 ~ +8
Legendary(4): 0 ~ +10
```

### 4.3. 고객 속성 확률
```
Fire, Water, Thunder, Earth, Air, Ice: 각각 15.5% (총 93%)
Light: 3.5%
Dark: 3.5%
```

---

## 5. 던전 생성 시스템

### 5.1. 던전 등급 결정 (고객 등급 기준)
```
고객 등급보다 -1등급: 15%
고객 등급과 동일: 70%
고객 등급보다 +1등급: 10%
고객 등급보다 +2등급: 4%
고객 등급보다 +3등급: 1%
```

### 5.2. 던전 레벨 결정
```
던전 레벨 = 고객 레벨 + Random(-10, +10)
```

### 5.3. 구체적 던전 선택
- 해당 등급의 던전 ScriptableObject 중 랜덤 선택

---

## 6. 보상 시스템

### 6.1. 골드 보상
```
골드 보상 = 기본값 × (던전레벨 × 0.5) × 던전등급배율

기본값: 300
던전등급배율:
- Common: ×1.0
- Uncommon: ×1.2  
- Rare: ×1.5
- Epic: ×2.5
- Legendary: ×10.0

예시: Rare 던전(레벨 15) = 300 × (15 × 0.5) × 1.5 = 3,375골드
```

### 6.2. 재료 보상
```
재료 선택: 던전SO의 MaterialData List에서 동등 확률로 선택

개수 결정 (등급별, 높은 개수일수록 낮은 확률):
Common: 3~7개
Uncommon: 3~5개  
Rare: 2~4개
Epic: 1~3개
Legendary: 1~2개
```

---

## 7. 무기 상점 시스템

### 7.1. 진행일수별 등급 확률
```
일수 구간별 등급 확률 (Common | Uncommon | Rare | Epic | Legendary):

초기(1~10일):     80% | 15% | 5%  | 0%   | 0%
초중반(11~20일):  75% | 18% | 5%  | 2%   | 0%
중반(21~40일):    73% | 18% | 6%  | 2%   | 1%
중후반(41~70일):  65% | 23% | 8%  | 3%   | 1%
후반(71일~):      60% | 25% | 10% | 3.5% | 1.5%
```

### 7.2. 가격 산정
```
무기 가격 = 기본가격 × 등급배율 × 일수보정

등급배율:
- Common: ×1.0
- Uncommon: ×1.5
- Rare: ×2.5
- Epic: ×5.0
- Legendary: ×10.0

일수보정: 1 + (일수 × 0.02)
```

---

## 8. 소요 시간 시스템

### 8.1. 모험 소요 일수
```
모험 소요 일수 = Round(등급보정 × Random(5~15))

등급보정:
Common: 0.2    (1~3일)
Uncommon: 0.3  (2~5일)  
Rare: 0.4      (2~6일)
Epic: 0.5      (3~8일)
Legendary: 1.0 (5~15일)
```

### 8.2. 제작 소요 시간
```
제작 소요 시간 = Round(등급보정 × Random(5~10))

등급보정: 동일 (0.2, 0.3, 0.4, 0.5, 1.0)
Common: 1~2일, Uncommon: 2~3일... Legendary: 5~10일
```

---

## 9. 페이즈 전환 시스템

### 9.1. 전환 조건
- **아침/낮**: 제한시간 경과 OR 다음페이즈 버튼 클릭
- **밤**: 다음날 버튼 클릭만 (제한시간 없음)

### 9.2. 자동저장
- 각 페이즈 전환 시마다 자동저장 실행

---

## 10. 실패 패널티 시스템

### 10.1. 무기 회수 확률 (일반 고객)
```
모험 실패 시 무기 회수 확률 (등급별):
Common: 30% 회수   |  70% 손실
Uncommon: 25% 회수 |  75% 손실  
Rare: 20% 회수     |  80% 손실
Epic: 15% 회수     |  85% 손실
Legendary: 10% 회수|  90% 손실
```

### 10.2. Hero 전용 무기 회수 확률 (강화된 회수율)
```
Hero 무기 회수 확률 (등급별):
Common: 40% 회수 (+10%)    |  60% 손실 (-10%)
Uncommon: 35% 회수 (+10%)  |  65% 손실 (-10%)  
Rare: 30% 회수 (+10%)      |  70% 손실 (-10%)
Epic: 25% 회수 (+10%)      |  75% 손실 (-10%)
Legendary: 20% 회수 (+10%) |  80% 손실 (-10%)

※ 일반 고객 대비 회수 확률 +10% 보정
```

### 10.3. 결과 표시
- **회수 성공**: "손님이 도망가서 돌아왔다"
- **회수 실패**: "손님이 던전 도전 중 사망"

---

## 11. 일일 이벤트 시스템

### 11.1. 이벤트 목록
1. 무기상점 등장 무기 +2개
2. 등장 손님 +2명  
3. 모든 무기 20% 할인
4. 골드 +500
5. 골드 -1000

### 11.2. 발생 타이밍
- 매일 아침 페이즈 시작 시 랜덤 이벤트 발생

---

## 12. 월세 시스템 (Rent System)

### 12.1. 월세 계산
- **주기**: 매주 (7일마다)
- **계산식**: 현재 일수 × 100 골드
- **예시**: 
  - 7일차: 700 골드
  - 14일차: 1,400 골드
  - 21일차: 2,100 골드

### 12.2. 월세 경고 시스템
- **경고 타이밍**: 납부일 하루 전 아침 페이즈 시작 시
- **경고 방식**: AlertPopup으로 납부해야 할 비용과 경고 메시지 표시
- **경고 메시지**: "내일 월세 X골드를 납부해야 합니다. 현재 보유 골드: Y골드"

### 12.3. 게임 오버 조건
- **조건**: 월세 납부일에 필요 골드 부족
- **체크 시점**: 매주 일요일 밤 페이즈 종료 시
- **결과**: 게임 오버 → 진행 일수 기록 → 새 게임 시작

### 12.4. GameConfig 추가 설정
```csharp
[Header("월세 시스템")]
public int rentPaymentDay = 7;        // 월세 납부 주기 (일)
public int rentMultiplier = 100;      // 일수당 월세 배율
public bool showRentWarning = true;   // 월세 납부일 임박 경고 표시
```

---

## 13. Hero 시스템

### 13.1. Hero 전환 시스템

#### 전환 확률 계산
```
기본 확률 (고객 등급별):
Common: 5%, Uncommon: 4%, Rare: 3%, Epic: 2%, Legendary: 1%

무기 등급 보정:
Common: -30%, Uncommon: 0%, Rare: +20%, Epic: +50%, Legendary: +100%

던전 등급 보정:
Common: -20%, Uncommon: 0%, Rare: +20%, Epic: +50%, Legendary: +100%

최종 확률 = 기본 확률 × (1 + (무기 보정 + 던전 보정) / 100)
```

#### 전환 조건
- **모험 성공 시에만** 확률 계산
- **전환 성공 시**: Customer 풀에서 제거, Hero 풀에 추가
- **도감 업데이트**: 그림자 아이콘 → 실제 아이콘으로 변경

### 13.2. Hero 레벨 시스템

#### 레벨업 조건
- **모험 성공 시**: Hero 레벨 +1
- **최대 레벨**: 100레벨
- **영향**: 성공률 계산의 고객레벨 부분에 반영

#### 초기 레벨
- **전환 시**: Customer의 현재 레벨을 그대로 승계
- **게임오버 후 새 게임**: 모든 Hero 레벨이 1로 초기화

### 13.3. Hero 실패 패널티

#### 부상 시스템
- **일반 고객**: 실패 시 사라짐 (사망)
- **Hero**: 실패 시 10일간 모험 불가 (부상 상태)

#### 부상 회복
- **회복 조건**: 시간 경과만 (추가 비용/아이템 불필요)
- **회복 기간**: 실패 후 정확히 10일
- **표시 방법**: 부상 중인 Hero는 회색 처리, 클릭 불가, "회복까지 X일 남음" 표시

### 13.4. Hero 도감 시스템

#### 도감 표시 방식
- **전체 Customer 풀**: 모든 가능한 Customer 표시
- **미획득**: 그림자 아이콘, 클릭 불가
- **획득**: 실제 아이콘, 클릭하여 상세 정보 확인 가능

#### 특수 능력 (추후 구현)
- **현재**: Hero 전용 성공률/회수 확률 보정만 적용
- **TODO**: 개별 Hero별 고유 특수 능력 추가

### 13.5. 게임오버 후 Hero 승계 시스템

#### 승계되는 요소
- **Hero 도감 수집 상태**: 유지
- **Hero 부상 상태**: 유지
- **Hero 보유 상태**: 유지

#### 초기화되는 요소
- **Hero 레벨**: 모든 Hero가 레벨 1로 초기화

#### Hero 잠금해제 조건 (새 게임 시)
```
Common Hero: 10일차부터 사용 가능
Uncommon Hero: 20일차부터 사용 가능
Rare Hero: 30일차부터 사용 가능
Epic Hero: 40일차부터 사용 가능
Legendary Hero: 50일차부터 사용 가능
```

---

## 14. 무기 판매 시스템

### 14.1. 판매 가능 품목
- **무기**: 판매 가능 (구매가의 50%)
- **재료**: 판매 불가

### 14.2. 판매 가격
```
판매 가격 = 구매 가격 × 0.5
```

### 14.3. 판매 방식
- **개별 판매**: 무기별로 개별 확인 팝업
- **일괄 판매**: 지원하지 않음

---

## 15. GameConfig 설정값

### 15.1. 기존 설정
```
startingGold: int = 5000
dayDuration: float = 300f
blacksmithUnlockDay: int = 3
weaponShopItemCount: int = 8
```

### 15.2. 추가 설정
```
inventoryMaxSize: int = 100 (인벤토리 최대 크기)
dailyCustomerCount: int = 6 (일일 방문 고객 수)
uiPageSize: int = 8 (리스트 한 페이지당 표시 개수)
weaponShopRefreshCost: int = 1000 (상점 새로고침 비용)
heroInjuryDays: int = 10 (Hero 부상 회복 기간)
```

### 15.3. Hero 시스템 설정
```
[Header("Hero 시스템")]
public int heroMaxLevel = 100;               // Hero 최대 레벨
public int[] heroUnlockDays = {10, 20, 30, 40, 50}; // 등급별 잠금해제 일수

[Header("Hero 전환 확률")]
public float[] heroBaseConversionRates = {5f, 4f, 3f, 2f, 1f}; // 등급별 기본 확률(%)
public float[] weaponGradeBonuses = {-30f, 0f, 20f, 50f, 100f}; // 무기 등급 보정(%)
public float[] dungeonGradeBonuses = {-20f, 0f, 20f, 50f, 100f}; // 던전 등급 보정(%)
```

---

## 16. UI 표시 방식

### 16.1. 리스트 페이지네이션
- 최대 수를 넘어가면 화살표 버튼으로 페이지 전환
- 한 페이지당 표시 개수는 GameConfig.uiPageSize로 설정

### 16.2. 팝업 계층 구조
- 메인 패널 → 상세 정보 팝업 → 하위 상세 팝업 순으로 계층화

---

## 17. Hero 전용 보상 및 페널티 시스템

### 17.1. Hero 성공 시 추가 보상

#### 17.1.1. 골드 보상 (Hero 보정 1.5배)
```
- Hero 골드 보상 = 일반 골드 보상 × 1.5
- 일반: 300 × (던전레벨 × 0.5) × 던전등급배율
- Hero: 일반 공식 × 1.5
- 예시: Epic 던전(레벨 20)
  - 일반: 300 × 10 × 2.5 = 7,500골드
  - Hero: 7,500 × 1.5 = 11,250골드
```

#### 17.1.2. 추가 레벨업 확률 (던전 등급 기반)
```
기본 레벨업: +1레벨 확정
추가 레벨업 확률 (던전 등급별):
Common:    1레벨(40%), 2레벨(40%), 3레벨(20%), 4레벨(0%), 5레벨(0%)
Uncommon:  1레벨(30%), 2레벨(40%), 3레벨(25%), 4레벨(5%), 5레벨(0%)
Rare:      1레벨(20%), 2레벨(30%), 3레벨(40%), 4레벨(9%), 5레벨(1%)
Epic:      1레벨(0%), 2레벨(20%), 3레벨(40%), 4레벨(25%), 5레벨(15%)
Legendary: 1레벨(0%), 2레벨(10%), 3레벨(30%), 4레벨(30%), 5레벨(30%)
→ 어려운 던전일수록 대폭 성장 가능!
```

### 17.2. Hero 모험 실패 시 페널티

#### 17.2.1. 부상 기간 및 치료 시스템
```
기본 부상 기간: 5일
부상 기간 = 5일 + (던전등급-Hero등급 보정) + (던전등급-무기등급 보정)
던전등급 - Hero등급 보정:
등급차이  보정값
-4:      -10일
-3:      -6일
-2:      -3일
-1:      0일
0:       +1일
+1:      +3일
+2:      +5일
+3:      +8일
+4:      +10일
던전등급 - 무기등급 보정:
등급차이  보정값
-4:      -7일
-3:      -4일
-2:      -2일
-1:      -1일
0:       0일
+1:      +1일
+2:      +2일
+3:      +4일
+4:      +7일
최종 부상 기간: 최소 1일, 최대 15일
```

#### 17.2.2. 치료비 (진행도 기반)
```
치료비 = 현재일수 × 50골드
예시:
10일차: -500골드
25일차: -1,250골드
50일차: -2,500골드

치료 방식: 골드 지불 시: 계산된 부상 기간만큼 대기 후 회복
골드 미지불 시: 영구적으로 사용 불가

치료 타이밍: 언제든지 가능 (부상 즉시 또는 나중에)
```

### 18.3. GameConfig 추가 설정
```csharp
[Header("Hero 보상 시스템")]
public float heroGoldMultiplier = 1.5f;      // Hero 골드 보정 배율
public int[] heroLevelUpProbabilities_Common = {40, 40, 20, 0, 0};
public int[] heroLevelUpProbabilities_Uncommon = {30, 40, 25, 5, 0};
public int[] heroLevelUpProbabilities_Rare = {20, 30, 40, 9, 1};
public int[] heroLevelUpProbabilities_Epic = {0, 20, 40, 25, 15};
public int[] heroLevelUpProbabilities_Legendary = {0, 10, 30, 30, 30};

[Header("Hero 페널티 시스템")]
public int heroGoldPenaltyPerDay = 50;       // 일수당 골드 페널티
public int heroBaseInjuryDays = 5;           // 기본 부상 기간
public int heroMinInjuryDays = 1;            // 최소 부상 기간
public int heroMaxInjuryDays = 15;           // 최대 부상 기간
public int[] heroDungeonGradePenalty = {-10, -6, -3, 0, 1, 3, 5, 8, 10}; // 던전-Hero 등급차 보정
public int[] weaponDungeonGradePenalty = {-7, -4, -2, -1, 0, 1, 2, 4, 7}; // 던전-무기 등급차 보정
```


## 18. 구현 시 참고사항

### 18.1. 우선 구현 필요
- 고객 생성 시스템
- 속성 상성 계산 로직
- 성공률 계산 시스템 (일반 고객 + Hero 분기)
- 무기 상점 진열 시스템
- 재료 보상 시스템
- **Hero 전환 확률 계산 로직**
- **Hero 도감 시스템**
- **Hero 부상 관리 시스템**
- **Hero 레벨업 시스템**
- **월세 경고 시스템**
- **무기 판매 시스템**
